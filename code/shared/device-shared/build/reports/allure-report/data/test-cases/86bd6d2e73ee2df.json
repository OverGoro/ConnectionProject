{"uid":"86bd6d2e73ee2df","name":"Should throw exception when adding device with duplicate UID","fullName":"com.connection.device.integration.DeviceRepositorySQLImplIntegrationTest.shouldThrowExceptionWhenAddingDeviceWithDuplicateUid","historyId":"15fe334054e0856469d7d06570ae0096","time":{"start":1761875953605,"stop":1761875953639,"duration":34},"description":"","status":"broken","statusMessage":"PreparedStatementCallback; SQL [INSERT INTO core.device (uid, client_uuid, device_name, device_description) VALUES (?, ?, ?, ?)]; ERROR: insert or update on table \"device\" violates foreign key constraint \"device_client_uuid_fkey\"\n  Подробности: Key (client_uuid)=(b9f1750f-807b-491c-b4d9-ec82c3b6cc9e) is not present in table \"client\".","statusTrace":"org.springframework.dao.DataIntegrityViolationException: PreparedStatementCallback; SQL [INSERT INTO core.device (uid, client_uuid, device_name, device_description) VALUES (?, ?, ?, ?)]; ERROR: insert or update on table \"device\" violates foreign key constraint \"device_client_uuid_fkey\"\n  Подробности: Key (client_uuid)=(b9f1750f-807b-491c-b4d9-ec82c3b6cc9e) is not present in table \"client\".\n\tat org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.doTranslate(SQLStateSQLExceptionTranslator.java:118)\n\tat org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)\n\tat org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:116)\n\tat org.springframework.jdbc.core.JdbcTemplate.translateException(JdbcTemplate.java:1556)\n\tat org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:677)\n\tat org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:972)\n\tat org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:993)\n\tat org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:337)\n\tat com.connection.device.repository.DeviceRepositorySQLImpl.add_aroundBody0(DeviceRepositorySQLImpl.java:72)\n\tat com.connection.device.repository.DeviceRepositorySQLImpl$AjcClosure1.run(DeviceRepositorySQLImpl.java:1)\n\tat org.springframework.transaction.aspectj.AbstractTransactionAspect.ajc$around$org_springframework_transaction_aspectj_AbstractTransactionAspect$1$2a73e96cproceed(AbstractTransactionAspect.aj:67)\n\tat org.springframework.transaction.aspectj.AbstractTransactionAspect$AbstractTransactionAspect$1.proceedWithInvocation(AbstractTransactionAspect.aj:73)\n\tat org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)\n\tat org.springframework.transaction.aspectj.AbstractTransactionAspect.ajc$around$org_springframework_transaction_aspectj_AbstractTransactionAspect$1$2a73e96c(AbstractTransactionAspect.aj:71)\n\tat com.connection.device.repository.DeviceRepositorySQLImpl.add(DeviceRepositorySQLImpl.java:57)\n\tat com.connection.device.integration.DeviceRepositorySQLImplIntegrationTest.shouldThrowExceptionWhenAddingDeviceWithDuplicateUid(DeviceRepositorySQLImplIntegrationTest.java:69)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)\nCaused by: org.postgresql.util.PSQLException: ERROR: insert or update on table \"device\" violates foreign key constraint \"device_client_uuid_fkey\"\n  Подробности: Key (client_uuid)=(b9f1750f-807b-491c-b4d9-ec82c3b6cc9e) is not present in table \"client\".\n\tat org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2734)\n\tat org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2421)\n\tat org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:372)\n\tat org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:518)\n\tat org.postgresql.jdbc.PgStatement.execute(PgStatement.java:435)\n\tat org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196)\n\tat org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157)\n\tat org.springframework.jdbc.core.JdbcTemplate.lambda$update$2(JdbcTemplate.java:977)\n\tat org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658)\n\t... 17 more\n","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setUp","time":{"start":1761875953605,"stop":1761875953613,"duration":8},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setUpRepository","time":{"start":1761875953613,"stop":1761875953613,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"tearDown","time":{"start":1761875953629,"stop":1761875953637,"duration":8},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"junit.platform.uniqueid","value":"[engine:junit-jupiter]/[class:com.connection.device.integration.DeviceRepositorySQLImplIntegrationTest]/[method:shouldThrowExceptionWhenAddingDeviceWithDuplicateUid()]"},{"name":"host","value":"Yurik"},{"name":"thread","value":"184775@Yurik.ForkJoinPool-1-worker-1(31)"},{"name":"framework","value":"junit-platform"},{"name":"language","value":"java"},{"name":"package","value":"com.connection.device.integration.DeviceRepositorySQLImplIntegrationTest"},{"name":"testClass","value":"com.connection.device.integration.DeviceRepositorySQLImplIntegrationTest"},{"name":"testMethod","value":"shouldThrowExceptionWhenAddingDeviceWithDuplicateUid"},{"name":"suite","value":"Device Repository SQL Implementation Integration Tests"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":0,"broken":2,"skipped":0,"passed":0,"unknown":0,"total":2},"items":[{"uid":"1afd90d9a164cb82","status":"broken","statusDetails":"PreparedStatementCallback; SQL [INSERT INTO core.device (uid, client_uuid, device_name, device_description) VALUES (?, ?, ?, ?)]; ERROR: insert or update on table \"device\" violates foreign key constraint \"device_client_uuid_fkey\"\n  Подробности: Key (client_uuid)=(b9f1750f-807b-491c-b4d9-ec82c3b6cc9e) is not present in table \"client\".","time":{"start":1761875953605,"stop":1761875953639,"duration":34}}]},"tags":[]},"source":"86bd6d2e73ee2df.json","parameterValues":[]}